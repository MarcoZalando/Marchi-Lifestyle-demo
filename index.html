<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marchi Lifestyle</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        /* Animaties */
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.3); opacity: 0.3; } }
        @keyframes pulse-fast { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.05); opacity: 0.6; } 100% { transform: scale(1); opacity: 0.8; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Slider Styling */
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #ffffff; box-shadow: 0 2px 6px rgba(0,0,0,0.2); cursor: pointer; margin-top: -8px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: rgba(255,255,255,0.3); border-radius: 4px; }
        
        /* Modal Animatie */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-enter { animation: slideUp 0.3s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
          Leaf, Moon, Activity, Droplets, ChevronRight, CheckCircle, Home, Plus, 
          Smile, Meh, Frown, Wind, Utensils, Footprints, User, ArrowRight, Play, 
          Pause, X, Clock, Headphones, Flame, StopCircle, Search, ChefHat, Coffee, 
          Sun, Moon as MoonIcon, Sparkles, Loader2, Calendar, BarChart2, Trophy, Check, Heart, List, Info
        } from 'https://esm.sh/lucide-react@0.292.0';

        // --- DATA ---
        const KLEUREN = {
            voeding: { main: 'text-emerald-600', bg: 'bg-emerald-100', border: 'border-emerald-200', fill: '#059669' },
            geest: { main: 'text-indigo-500', bg: 'bg-indigo-100', border: 'border-indigo-200', fill: '#6366F1' },
            beweging: { main: 'text-rose-500', bg: 'bg-rose-100', border: 'border-rose-200', fill: '#F43F5E' },
        };

        const MOCK_HISTORY = Array.from({length: 30}, (_, i) => ({ date: new Date(Date.now() - (29 - i) * 86400000), score: Math.floor(Math.random() * 60) + 40 }));

        // Recepten met dummy details
        const RECEPTEN_DATABASE = [
            { id: 'o1', naam: 'Havermout Power Bowl', type: 'ochtend', cal: 350, bevat: ['gluten', 'vega'], doelen: ['Meer energie'], ingredienten: ['Havermout', 'Amandelmelk', 'Banaan', 'Chia zaad'], bereiding: 'Kook de havermout in de melk. Top af met banaan en zaden.' },
            { id: 'o2', naam: 'Griekse Yoghurt & Noten', type: 'ochtend', cal: 280, bevat: ['lactose', 'noten', 'vega', 'keto'], doelen: ['Afvallen'], ingredienten: ['Griekse Yoghurt', 'Walnoten', 'Honing', 'Blauwe bessen'], bereiding: 'Meng alles in een kom.' },
            { id: 'l1', naam: 'Quinoa Salade', type: 'lunch', cal: 450, bevat: ['vegan', 'vega'], doelen: ['Meer energie'], ingredienten: ['Quinoa', 'Komkommer', 'Tomaat', 'Citroendressing'], bereiding: 'Kook quinoa, snij groenten fijn en meng.' },
            { id: 'l2', naam: 'Kip Avocado Wrap', type: 'lunch', cal: 500, bevat: ['gluten', 'carnivoor'], doelen: ['Spieropbouw'], ingredienten: ['Volkoren wrap', 'Kipfilet', 'Avocado', 'Ijsbergsla'], bereiding: 'Vul de wrap en rol op.' },
            { id: 'a1', naam: 'Gegrilde Zalm', type: 'avond', cal: 550, bevat: ['vis', 'keto'], doelen: ['Beter slapen'], ingredienten: ['Zalmfilet', 'Asperges', 'Citroen', 'Olijfolie'], bereiding: 'Grill de zalm 4 min per kant. Serveer met asperges.' },
            { id: 'a4', naam: 'Kip met Rijst & Broccoli', type: 'avond', cal: 500, bevat: ['carnivoor'], doelen: ['Spieropbouw'], ingredienten: ['Kipfilet', 'Zilvervliesrijst', 'Broccoli', 'Sojasaus'], bereiding: 'Kook rijst en broccoli. Bak de kip goudbruin.' },
        ];

        const MEDITATIES = [
            { id: 'sleep', titel: "Diepe Slaap", ondertitel: "Laat de dag los", duur: 600, tags: ['slaap', 'avond', 'moe'] },
            { id: 'sos', titel: "SOS Ademhaling", ondertitel: "Directe rust", duur: 180, tags: ['stress', 'angst', 'slecht'] },
            { id: 'gratitude', titel: "Dankbaarheid", ondertitel: "Waardering voelen", duur: 300, tags: ['geluk', 'rust', 'goed'] },
            { id: 'focus', titel: "Laser Focus", ondertitel: "Voor werk of studie", duur: 300, tags: ['focus', 'werk', 'neutraal'] },
            { id: 'morning', titel: "Ochtend Energie", ondertitel: "Start krachtig", duur: 240, tags: ['ochtend', 'energie', 'goed'] },
        ];

        const WORKOUTS = [
            { id: 'walk', naam: 'Stevige Wandeling', type: 'cardio', calPerMin: 5, animatie: 'bounce', icon: Footprints, kleur: 'bg-emerald-500' },
            { id: 'yoga', naam: 'Ochtend Flow', type: 'flexibility', calPerMin: 3, animatie: 'breathe', icon: Wind, kleur: 'bg-indigo-500' },
            { id: 'hiit', naam: 'Full Body HIIT', type: 'kracht', calPerMin: 10, animatie: 'pulse-fast', icon: Activity, kleur: 'bg-rose-500' },
        ];

        // --- APP ---

        function MarchiApp() {
            const [scherm, setScherm] = useState('onboarding'); 
            const [gebruiker, setGebruiker] = useState({ naam: '', leeftijd: '', geslacht: '', gewicht: '', doelen: [], allergieen: [] });
            
            // State start nu netjes op 0
            const [dagLog, setDagLog] = useState({
                water: 0, 
                stemming: 5, 
                stappen: 0, 
                maaltijden: [],
                verbrandeCalorieen: 0, 
                meditatieGedaan: false, 
                workoutGedaan: false,
            });

            const rondOnboardingAf = (profielData) => {
                setGebruiker({ ...gebruiker, ...profielData });
                setScherm('dashboard');
            };

            const renderScherm = () => {
                switch(scherm) {
                    case 'onboarding': return <Onboarding onComplete={rondOnboardingAf} />;
                    case 'dashboard': return <Dashboard gebruiker={gebruiker} dagLog={dagLog} setDagLog={setDagLog} navigeer={setScherm} />;
                    case 'voeding': return <VoedingModule dagLog={dagLog} setDagLog={setDagLog} navigeer={setScherm} gebruiker={gebruiker} />;
                    case 'geest': return <GeestModule dagLog={dagLog} setDagLog={setDagLog} navigeer={setScherm} />;
                    case 'beweging': return <BewegingModule dagLog={dagLog} setDagLog={setDagLog} navigeer={setScherm} />;
                    default: return <Dashboard gebruiker={gebruiker} dagLog={dagLog} navigeer={setScherm} />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 flex justify-center font-sans text-slate-800">
                    <div className="w-full max-w-md bg-white h-screen shadow-2xl overflow-hidden flex flex-col relative">
                        {renderScherm()}
                        {scherm !== 'onboarding' && (
                            <div className="absolute bottom-0 w-full bg-white border-t border-slate-100 flex justify-around py-3 pb-6 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20">
                                <TabIcon icon={Home} label="Vandaag" active={scherm === 'dashboard'} onClick={() => setScherm('dashboard')} />
                                <TabIcon icon={Leaf} label="Voeding" active={scherm === 'voeding'} color="text-emerald-600" onClick={() => setScherm('voeding')} />
                                <TabIcon icon={Moon} label="Geest" active={scherm === 'geest'} color="text-indigo-500" onClick={() => setScherm('geest')} />
                                <TabIcon icon={Activity} label="Beweging" active={scherm === 'beweging'} color="text-rose-500" onClick={() => setScherm('beweging')} />
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const TabIcon = ({ icon: Icon, label, active, onClick, color = 'text-slate-800' }) => (
            <button onClick={onClick} className="flex flex-col items-center justify-center w-16 relative">
                <Icon size={24} className={`${active ? color : 'text-slate-300'} transition-colors duration-300`} strokeWidth={active ? 2.5 : 2} />
                <span className={`text-[10px] mt-1 font-medium ${active ? 'text-slate-800' : 'text-slate-300'}`}>{label}</span>
                {active && <div className={`absolute -top-1 w-1 h-1 rounded-full ${color.replace('text-', 'bg-')}`}></div>}
            </button>
        );

        // --- ONBOARDING ---
        const Onboarding = ({ onComplete }) => {
            const [stap, setStap] = useState(1);
            const [data, setData] = useState({ naam: '', leeftijd: '', geslacht: '', gewicht: '', doelen: [], allergieen: [] });
            const toggleSelectie = (veld, waarde) => { setData(prev => { const bestaat = prev[veld].includes(waarde); return { ...prev, [veld]: bestaat ? prev[veld].filter(i => i !== waarde) : [...prev[veld], waarde] }; }); };

            return (
                <div className="flex-1 p-8 flex flex-col justify-between bg-gradient-to-br from-emerald-50 to-white">
                    <div className="mt-10">
                        <div className="w-full bg-slate-100 h-2 rounded-full mb-8"><div className="bg-emerald-500 h-2 rounded-full transition-all duration-500" style={{ width: `${stap * 25}%` }}></div></div>
                        {stap === 1 && <div className="animate-in fade-in slide-in-from-bottom-4"><h1 className="text-3xl font-bold text-slate-800 mb-2">Welkom bij Marchi.</h1><input type="text" placeholder="Jouw naam" className="w-full text-2xl border-b-2 border-emerald-200 py-2 focus:outline-none bg-transparent" value={data.naam} onChange={(e) => setData({...data, naam: e.target.value})} /></div>}
                        {stap === 2 && <div className="animate-in fade-in slide-in-from-bottom-4"><h1 className="text-2xl font-bold text-slate-800 mb-4">Jouw Profiel</h1><div className="space-y-4"><input type="number" placeholder="Leeftijd" className="w-full p-3 border rounded-xl" value={data.leeftijd} onChange={(e) => setData({...data, leeftijd: e.target.value})} /><input type="number" placeholder="Gewicht (kg)" className="w-full p-3 border rounded-xl" value={data.gewicht} onChange={(e) => setData({...data, gewicht: e.target.value})} /><div className="flex gap-2">{['Vrouw', 'Man'].map(o => <button key={o} onClick={() => setData({...data, geslacht: o})} className={`flex-1 p-3 rounded-xl border ${data.geslacht === o ? 'bg-emerald-100 border-emerald-500 font-bold' : 'bg-white'}`}>{o}</button>)}</div></div></div>}
                        {stap === 3 && <div className="animate-in fade-in slide-in-from-bottom-4"><h1 className="text-2xl font-bold text-slate-800 mb-2">Doelen</h1><div className="space-y-2 mt-4">{['Meer energie', 'Afvallen', 'Stress verminderen', 'Spieropbouw', 'Conditie'].map(d => <button key={d} onClick={() => toggleSelectie('doelen', d)} className={`w-full p-4 rounded-xl text-left border ${data.doelen.includes(d) ? 'bg-emerald-100 border-emerald-500 text-emerald-800' : 'bg-white'}`}>{d}</button>)}</div></div>}
                        {stap === 4 && <div className="animate-in fade-in slide-in-from-bottom-4"><h1 className="text-2xl font-bold text-slate-800 mb-2">Voorkeuren</h1><div className="flex flex-wrap gap-2">{['Gluten', 'Lactose', 'Vega', 'Keto', 'Paleo', 'Carnivoor'].map(item => <button key={item} onClick={() => toggleSelectie('allergieen', item)} className={`px-4 py-2 rounded-full border ${data.allergieen.includes(item) ? 'bg-rose-100 border-rose-500 text-rose-700' : 'bg-white'}`}>{item}</button>)}</div></div>}
                    </div>
                    <button disabled={(stap === 1 && !data.naam) || (stap === 2 && !data.leeftijd)} onClick={() => { if (stap < 4) setStap(stap + 1); else onComplete(data); }} className="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg flex items-center justify-center gap-2 disabled:opacity-50">{stap === 4 ? 'Start mijn reis' : 'Volgende'} <ArrowRight size={18}/></button>
                </div>
            );
        };

        // --- DASHBOARD ---
        const Dashboard = ({ gebruiker, dagLog, setDagLog, navigeer }) => {
            const [view, setView] = useState('vandaag');
            const [confettiGevierd, setConfettiGevierd] = useState(false);

            const scoreWater = (Math.min(dagLog.water, 8) / 8) * 20;
            const scoreStappen = (Math.min(dagLog.stappen, 6000) / 6000) * 20;
            const scoreMind = dagLog.meditatieGedaan ? 20 : 0;
            const scoreBody = dagLog.workoutGedaan ? 20 : 0;
            const scoreVoeding = Math.min(1, dagLog.maaltijden.length / 3) * 20;
            const balansScore = Math.min(100, Math.round(scoreWater + scoreStappen + scoreMind + scoreBody + scoreVoeding));

            useEffect(() => {
                if (balansScore === 100 && !confettiGevierd) {
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#10B981', '#6366F1', '#F43F5E'] });
                    setConfettiGevierd(true);
                }
            }, [balansScore, confettiGevierd]);

            return (
                <div className="flex-1 bg-slate-50 overflow-y-auto pb-24 flex flex-col h-full">
                    <div className="bg-white pb-6 rounded-b-[32px] shadow-sm mb-4 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-emerald-400 via-indigo-400 to-rose-400"></div>
                        <div className="p-6 pt-12">
                            <div className="flex justify-between items-center mb-6">
                                <div><h2 className="text-slate-400 text-sm font-medium">Hallo,</h2><h1 className="text-2xl font-bold text-slate-800">{gebruiker.naam || 'Gast'}</h1></div>
                                <div className="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center border border-slate-200"><User size={20} className="text-slate-600" /></div>
                            </div>
                            <div className="bg-slate-100 p-1 rounded-xl flex mb-6">
                                <button onClick={() => setView('vandaag')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'vandaag' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400'}`}>Vandaag</button>
                                <button onClick={() => setView('geschiedenis')} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${view === 'geschiedenis' ? 'bg-white text-slate-800 shadow-sm' : 'text-slate-400'}`}>Geschiedenis</button>
                            </div>
                            {view === 'vandaag' ? (
                                <div className="flex flex-col items-center">
                                    <div className="relative w-48 h-48 flex items-center justify-center mb-2">
                                        <svg className="w-full h-full transform -rotate-90"><circle cx="96" cy="96" r="80" stroke="#F1F5F9" strokeWidth="16" fill="none" /><circle cx="96" cy="96" r="80" stroke={balansScore === 100 ? "#10B981" : "#3B82F6"} strokeWidth="16" fill="none" strokeDasharray="502" strokeDashoffset={502 - (502 * balansScore / 100)} strokeLinecap="round" className="transition-all duration-1000 ease-out" /></svg>
                                        <div className="absolute flex flex-col items-center">
                                            {balansScore === 100 ? <div className="bg-emerald-100 p-3 rounded-full mb-1"><Trophy size={32} className="text-emerald-600" /></div> : <span className="text-5xl font-black text-slate-800 tracking-tight">{balansScore}%</span>}
                                            <span className="text-xs text-slate-400 font-bold uppercase tracking-widest mt-1">{balansScore === 100 ? "DOEL BEHAALD!" : "DAGDOEL"}</span>
                                        </div>
                                    </div>
                                </div>
                            ) : <HistoryView />}
                        </div>
                    </div>
                    {view === 'vandaag' && (
                        <div className="px-6 space-y-4 animate-in slide-in-from-bottom-4">
                            <div className="flex justify-between items-end"><h3 className="text-lg font-bold text-slate-800">Checklist</h3><span className="text-xs font-medium text-slate-400">{5 - (Math.floor(balansScore/20))} taken over</span></div>
                            <ChecklistCard type="voeding" titel="Eetlogboek" subtitel={`${dagLog.maaltijden.length} / 3 maaltijden`} onClick={() => navigeer('voeding')} icon={Utensils} isCompleted={dagLog.maaltijden.length >= 3} />
                            <ChecklistCard type="geest" titel="Mindset" subtitel={dagLog.meditatieGedaan ? "Voltooid" : "Doe een check-in"} onClick={() => navigeer('geest')} icon={Moon} isCompleted={dagLog.meditatieGedaan} />
                            <ChecklistCard type="beweging" titel="Beweging" subtitel={`${dagLog.verbrandeCalorieen} kcal verbrand`} onClick={() => navigeer('beweging')} icon={Footprints} isCompleted={dagLog.workoutGedaan || dagLog.stappen >= 6000} />
                            
                            {/* WATER ITEM - NU MET AFVINK LOGICA */}
                            <div className={`p-4 rounded-2xl flex items-center justify-between border transition-all duration-300 ${dagLog.water >= 8 ? 'bg-slate-50 border-slate-100 opacity-70' : 'bg-white border-slate-100 shadow-sm'}`}>
                                <div className="flex items-center gap-4">
                                    <div className={`p-3 rounded-xl ${dagLog.water >= 8 ? 'bg-slate-200 text-slate-500' : 'bg-blue-100 text-blue-600'}`}><Droplets size={24} /></div>
                                    <div><h4 className={`font-bold ${dagLog.water >= 8 ? 'text-slate-500 line-through decoration-slate-300' : 'text-slate-700'}`}>Water drinken</h4><p className="text-xs text-slate-400">{dagLog.water} / 8 glazen</p></div>
                                </div>
                                <div className="flex items-center gap-3">
                                    {dagLog.water >= 8 ? <div className="w-8 h-8 bg-emerald-600 rounded-full flex items-center justify-center"><Check size={18} className="text-white" strokeWidth={3} /></div> : 
                                    <button onClick={() => setDagLog({...dagLog, water: Math.min(8, dagLog.water + 1)})} className="bg-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg active:scale-90 transition-transform"><Plus size={20} /></button>}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const HistoryView = () => (
            <div className="animate-in fade-in duration-500 w-full">
                <div className="grid grid-cols-2 gap-4 mb-6">
                    <div className="bg-orange-50 border border-orange-100 p-4 rounded-2xl flex flex-col items-center"><span className="text-3xl font-black text-slate-800">4</span><span className="text-[10px] text-slate-400 uppercase">Dagen Streak</span></div>
                    <div className="bg-blue-50 border border-blue-100 p-4 rounded-2xl flex flex-col items-center"><span className="text-3xl font-black text-slate-800">78%</span><span className="text-[10px] text-slate-400 uppercase">Gemiddelde</span></div>
                </div>
                <div className="grid grid-cols-7 gap-2">{MOCK_HISTORY.map((item, idx) => <div key={idx} className={`aspect-square rounded-lg flex items-center justify-center text-[10px] font-medium ${item.score === 100 ? 'bg-emerald-500 text-white' : 'bg-slate-100 text-slate-400'}`}>{item.date.getDate()}</div>)}</div>
            </div>
        );

        const ChecklistCard = ({ type, titel, subtitel, onClick, icon: Icon, isCompleted }) => {
            const style = KLEUREN[type];
            return (
                <button onClick={onClick} className={`w-full p-4 rounded-2xl border flex items-center justify-between group transition-all duration-300 ${isCompleted ? 'bg-slate-50 border-slate-100 opacity-70' : 'bg-white border-slate-100 shadow-sm active:scale-[0.98]'}`}>
                    <div className="flex items-center gap-4"><div className={`p-3 rounded-xl transition-colors ${isCompleted ? 'bg-slate-200 text-slate-500' : `${style.bg} ${style.main}`}`}><Icon size={24} /></div><div className="text-left"><h4 className={`font-bold transition-colors ${isCompleted ? 'text-slate-500 line-through decoration-slate-300' : 'text-slate-800'}`}>{titel}</h4><p className="text-sm text-slate-400">{subtitel}</p></div></div>
                    <div className={`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all ${isCompleted ? `${style.main} border-current bg-current` : 'border-slate-200 bg-white'}`}>{isCompleted && <Check size={18} className="text-white" strokeWidth={3} />}</div>
                </button>
            );
        };

        // --- VOEDING MODULE ---
        const VoedingModule = ({ dagLog, setDagLog, navigeer, gebruiker }) => {
            const [activeTab, setActiveTab] = useState('log');
            const [zoekTerm, setZoekTerm] = useState('');
            const [actiefRecept, setActiefRecept] = useState(null);

            const voegHandmatigToe = async () => {
                if(!zoekTerm) return;
                const cal = 300; // Simpele fallback
                setDagLog(prev => ({ ...prev, maaltijden: [...prev.maaltijden, { id: Date.now(), naam: zoekTerm, type: 'handmatig', calorieen: cal, isHandmatig: true }] }));
                setZoekTerm('');
            };
            
            const voegReceptToe = (recept) => {
                setDagLog(prev => ({ ...prev, maaltijden: [...prev.maaltijden, { ...recept, gezond: true, calorieen: recept.cal }] }));
                setActiefRecept(null);
            };

            return (
                <div className="flex-1 bg-white overflow-y-auto pb-24 flex flex-col">
                    <Header titel="Voeding" subtitel="Voed je lichaam" kleur="text-emerald-600" onBack={() => navigeer('dashboard')} />
                    <div className="px-6 mt-2 mb-4"><div className="flex bg-slate-100 p-1 rounded-xl"><button onClick={() => setActiveTab('log')} className={`flex-1 py-2 rounded-lg text-sm font-medium ${activeTab === 'log' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-400'}`}>Logboek</button><button onClick={() => setActiveTab('inspiratie')} className={`flex-1 py-2 rounded-lg text-sm font-medium ${activeTab === 'inspiratie' ? 'bg-white text-emerald-600 shadow-sm' : 'text-slate-400'}`}>Inspiratie</button></div></div>
                    
                    {activeTab === 'log' ? (
                        <div className="p-6 pt-2">
                            <div className="flex gap-2 mb-6 relative">
                                <input type="text" placeholder="Bijv. Boterham kaas" className="w-full bg-slate-50 border border-slate-200 rounded-xl py-3 pl-4 pr-4 focus:outline-none focus:border-emerald-300" value={zoekTerm} onChange={(e) => setZoekTerm(e.target.value)} />
                                {/* NIEUW: Simpele Plus Knop in plaats van AI */}
                                <button onClick={voegHandmatigToe} disabled={!zoekTerm} className="bg-emerald-600 text-white w-12 rounded-xl flex items-center justify-center shadow-md active:scale-90 transition-transform"><Plus size={24}/></button>
                            </div>
                            <div className="bg-emerald-50 p-6 rounded-3xl"><h3 className="text-emerald-800 font-bold mb-2">Vandaag</h3><div className="space-y-2">{dagLog.maaltijden.map((m, idx) => <div key={idx} className="bg-white/80 p-3 rounded-xl text-sm flex justify-between"><span>{m.naam}</span><span className="font-bold text-emerald-600">{m.calorieen} kcal</span></div>)}</div></div>
                        </div>
                    ) : (
                        <div className="p-6 pt-2 space-y-6">
                            {RECEPTEN_DATABASE.map(r => (
                                <div key={r.id} onClick={() => setActiefRecept(r)} className="bg-white border border-slate-100 rounded-2xl p-4 shadow-sm active:scale-95 transition-transform cursor-pointer">
                                    <h4 className="font-bold text-slate-800">{r.naam}</h4>
                                    <p className="text-xs text-slate-400">{r.cal} kcal • {r.type}</p>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* RECEPT DETAIL MODAL */}
                    {actiefRecept && (
                        <div className="fixed inset-0 z-50 flex items-end justify-center bg-black/50 backdrop-blur-sm" onClick={() => setActiefRecept(null)}>
                            <div className="bg-white w-full max-w-md rounded-t-3xl p-6 modal-enter" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-start mb-4">
                                    <div><h2 className="text-2xl font-bold text-slate-800">{actiefRecept.naam}</h2><p className="text-emerald-600 font-medium">{actiefRecept.cal} kcal</p></div>
                                    <button onClick={() => setActiefRecept(null)} className="bg-slate-100 p-2 rounded-full"><X size={20}/></button>
                                </div>
                                <div className="mb-6">
                                    <h4 className="font-bold text-sm uppercase text-slate-400 mb-2">Ingrediënten</h4>
                                    <ul className="list-disc pl-5 text-slate-700 text-sm space-y-1">{actiefRecept.ingredienten.map((ing, i) => <li key={i}>{ing}</li>)}</ul>
                                </div>
                                <div className="mb-8">
                                    <h4 className="font-bold text-sm uppercase text-slate-400 mb-2">Bereiding</h4>
                                    <p className="text-slate-700 text-sm">{actiefRecept.bereiding}</p>
                                </div>
                                <button onClick={() => voegReceptToe(actiefRecept)} className="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg">Voeg toe aan dagboek</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- GEEST MODULE ---
        const GeestModule = ({ dagLog, setDagLog, navigeer }) => {
            const [actieveSessie, setActieveSessie] = useState(null);
            const bgClass = dagLog.stemming <= 3 ? 'bg-slate-900 text-white' : dagLog.stemming <= 6 ? 'bg-indigo-50 text-slate-800' : 'bg-orange-50 text-slate-800';
            const accentClass = dagLog.stemming <= 3 ? 'text-indigo-300' : dagLog.stemming <= 6 ? 'text-indigo-600' : 'text-orange-600';
            
            const getStemmingTekst = (s) => {
                if (s <= 2) return "Ik voel me opgebrand";
                if (s <= 4) return "Ik ben gestrest";
                if (s <= 5) return "Het gaat wel";
                if (s <= 6) return "Ik voel me kalm";
                if (s <= 8) return "Ik voel me goed";
                return "Ik voel me fantastisch!";
            };

            const suggestie = MEDITATIES[0]; // Simplificatie voor demo
            
            // Universele handler voor voltooien
            const voltooiSessie = () => {
                setDagLog({...dagLog, meditatieGedaan: true});
                setActieveSessie(null);
            };

            if (actieveSessie) return <MeditatieSpeler sessie={actieveSessie} onClose={() => setActieveSessie(null)} onComplete={voltooiSessie} />;

            return (
                <div className={`flex-1 overflow-y-auto pb-24 transition-colors duration-700 ${bgClass}`}>
                    <Header titel="Geest" subtitel="Vind je rust" kleur={accentClass} onBack={() => navigeer('dashboard')} dark={dagLog.stemming <= 3} />
                    <div className="p-6">
                        <div className={`mb-8 text-center rounded-3xl p-6 transition-all duration-500 ${dagLog.stemming <= 3 ? 'bg-white/10' : 'bg-white shadow-sm'}`}>
                            <h3 className="font-bold text-lg mb-6">Hoe voel je je?</h3>
                            <div className="flex justify-between px-2 text-2xl mb-4">
                                <Frown className={dagLog.stemming < 5 ? 'scale-125 opacity-100' : 'opacity-30'} />
                                <Meh className={dagLog.stemming >= 5 && dagLog.stemming <= 6 ? 'scale-125 opacity-100' : 'opacity-30'} />
                                <Smile className={dagLog.stemming > 6 ? 'scale-125 opacity-100' : 'opacity-30'} />
                            </div>
                            <input type="range" min="1" max="10" value={dagLog.stemming} onChange={(e) => setDagLog({...dagLog, stemming: parseInt(e.target.value)})} className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-current mb-4" />
                            <p className={`font-bold text-lg ${accentClass}`}>{getStemmingTekst(dagLog.stemming)}</p>
                        </div>

                        <h3 className="font-bold mb-4">Aanbevolen</h3>
                        <button onClick={() => setActieveSessie(suggestie)} className="w-full bg-gradient-to-r from-indigo-500 to-purple-600 rounded-3xl p-6 relative overflow-hidden text-left mb-8 shadow-lg">
                            <div className="relative z-10 text-white">
                                <span className="text-[10px] font-bold px-2 py-1 bg-white/20 rounded-full mb-2 inline-block">TIP</span>
                                <h4 className="text-2xl font-bold mb-1">{suggestie.titel}</h4>
                                <div className="flex items-center gap-2 text-xs"><Clock size={12}/> {suggestie.duur/60} min</div>
                            </div>
                        </button>

                        <h3 className="font-bold mb-4">Bibliotheek</h3>
                        <div className="space-y-3">{MEDITATIES.map(med => (
                            <button key={med.id} onClick={() => setActieveSessie(med)} className={`w-full flex items-center gap-4 p-4 border rounded-2xl text-left ${dagLog.stemming <= 3 ? 'border-white/10 hover:bg-white/5' : 'border-slate-100 hover:bg-slate-50'}`}>
                                <div className="p-2 bg-white/10 rounded-lg"><Headphones size={20}/></div>
                                <div><h4 className="font-bold">{med.titel}</h4><p className="text-xs opacity-70">{med.ondertitel}</p></div>
                            </button>
                        ))}</div>
                    </div>
                </div>
            );
        };

        // --- BEWEGING ---
        const BewegingModule = ({ dagLog, setDagLog, navigeer }) => {
            const [actieveWorkout, setActieveWorkout] = useState(null);
            if (actieveWorkout) return <WorkoutSpeler workout={actieveWorkout} onClose={() => setActieveWorkout(null)} onComplete={(cal) => { setDagLog(prev => ({ ...prev, stappen: prev.stappen + 500, verbrandeCalorieen: prev.verbrandeCalorieen + cal, workoutGedaan: true })); setActieveWorkout(null); }} />;
            return (
                <div className="flex-1 bg-white overflow-y-auto pb-24">
                    <Header titel="Beweging" subtitel="Houd je flow" kleur="text-rose-500" onBack={() => navigeer('dashboard')} />
                    <div className="p-6">
                        <div className="flex justify-between bg-slate-800 text-white p-6 rounded-3xl mb-8"><div><p className="text-sm text-slate-400">Verbrand</p><h2 className="text-4xl font-bold">{dagLog.verbrandeCalorieen} <span className="text-lg font-normal text-slate-400">kcal</span></h2></div><Flame size={32} className="text-rose-500"/></div>
                        <h3 className="font-bold text-slate-800 mb-4">Start Workout</h3>
                        <div className="space-y-3">{WORKOUTS.map(w => <button key={w.id} onClick={() => setActieveWorkout(w)} className="w-full flex justify-between items-center p-4 bg-rose-50 rounded-2xl text-rose-900 font-bold"><span>{w.naam}</span><Play size={20}/></button>)}</div>
                    </div>
                </div>
            );
        };

        // --- SPELERS ---
        const WorkoutSpeler = ({ workout, onClose, onComplete }) => {
            const [sec, setSec] = useState(0);
            useEffect(() => { const i = setInterval(() => setSec(s => s + 1), 1000); return () => clearInterval(i); }, []);
            const cal = Math.floor((sec/60) * workout.calPerMin);
            return (
                <div className={`absolute inset-0 z-50 ${workout.kleur} flex flex-col text-white p-6 pt-12 animate-in slide-in-from-bottom`}>
                    <button onClick={onClose} className="self-start mb-8"><X/></button>
                    <div className="flex-1 flex flex-col items-center justify-center">
                        <div className="text-8xl font-black mb-4">{Math.floor(sec/60)}:{sec%60 < 10 ? '0'+sec%60 : sec%60}</div>
                        <div className="flex gap-4 text-xl"><span className="flex gap-2"><Flame/> {cal} kcal</span><span className="flex gap-2"><Heart className="animate-pulse"/> 110 bpm</span></div>
                    </div>
                    <button onClick={() => onComplete(cal)} className="w-full bg-white text-slate-900 py-4 rounded-2xl font-bold text-lg mt-8">Klaar</button>
                </div>
            );
        };

        const MeditatieSpeler = ({ sessie, onClose, onComplete }) => {
            const [sec, setSec] = useState(sessie.duur);
            useEffect(() => { const i = setInterval(() => setSec(s => s > 0 ? s - 1 : 0), 1000); return () => clearInterval(i); }, []);
            return (
                <div className="absolute inset-0 z-50 bg-slate-900 flex flex-col text-white p-6 pt-12 animate-in slide-in-from-bottom">
                    <button onClick={onClose} className="self-start mb-8"><X/></button>
                    <div className="flex-1 flex flex-col items-center justify-center text-center">
                        <h2 className="text-3xl font-bold mb-2">{sessie.titel}</h2>
                        <div className="text-6xl font-thin my-8">{Math.floor(sec/60)}:{sec%60 < 10 ? '0'+sec%60 : sec%60}</div>
                    </div>
                    {/* Demo knop om direct af te ronden */}
                    <button onClick={onComplete} className="w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg">Voltooi Sessie</button>
                </div>
            );
        };

        const Header = ({ titel, subtitel, kleur, onBack, dark }) => (
            <div className={`pt-12 px-6 pb-4 sticky top-0 z-10 ${dark ? 'bg-slate-900 border-white/10' : 'bg-white border-slate-50 border-b'}`}>
                <button onClick={onBack} className={`mb-4 flex items-center gap-1 text-sm font-medium ${dark ? 'text-white/70' : 'text-slate-400'}`}><ChevronRight className="rotate-180" size={16} /> Terug</button>
                <h1 className={`text-3xl font-bold ${kleur}`}>{titel}</h1><p className={dark ? 'text-white/50' : 'text-slate-400'}>{subtitel}</p>
            </div>
        );

        const root = createRoot(document.getElementById('root'));
        root.render(<MarchiApp />);
    </script>
</body>
</html>